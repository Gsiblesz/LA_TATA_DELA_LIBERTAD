<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Formularios | EL CENTRO</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">
          <p class="eyebrow">Panel de accesos</p>
          <h1>Formularios<br />EL CENTRO</h1>
          <p class="subtitle">Gestiona Solicitudes de Sedes, Entregado a Sedes y Producción.</p>
        </div>
        <nav class="sidebar__nav">
          <button class="nav-btn active" data-view-target="home">Menú EL CENTRO</button>
          <button class="nav-btn" data-view-target="solicitudes">Solicitudes de Sedes</button>
          <button class="nav-btn" data-view-target="registros">Entregado a Sedes</button>
          <button class="nav-btn" data-view-target="mermas">Merma de Producción</button>
          <button class="nav-btn" data-view-target="catalogo">Catálogo de productos</button>
        </nav>
        <footer class="sidebar__footer">
          <small>Elaborado por el pasante de producción Gerardo Siblesz</small>
        </footer>
      </aside>

      <main class="main">
        <div id="env-warning" class="alert alert--warn hidden">
          Define la URL del Apps Script en <code>script.js</code> (constante <code>APPS_SCRIPT_URL</code>)
          para habilitar la sincronización con Google Sheets.
        </div>

        <section class="view active" data-view="home">
          <div class="alert alert--info" role="status">
            <strong>Importante:</strong> antes de llenar un formulario, refresca la página para asegurarte de que el catálogo y los datos estén sincronizados.
          </div>
          <article class="hero-card">
            <div>
              <p class="eyebrow">Panel de accesos</p>
              <h2>Bienvenido al menú de solicitudes y entregas de EL CENTRO</h2>
              <p class="hero-card__description">
                Desde aquí podrás registrar Solicitudes de Sedes, confirmar Entregado a Sedes y documentar Producción.
                Todos los formularios se conectan a la misma hoja de Google Sheets.
              </p>
            </div>
            <div class="hero-card__cta hero-card__cta--link">
              <a
                class="btn"
                href="https://menu-formularios-la-tata.vercel.app/"
                target="_blank"
                rel="noopener noreferrer"
              >
                Volver al menú principal
              </a>
            </div>
          </article>

          <section class="operations-card card">
            <div>
              <p class="eyebrow">Operación diaria</p>
              <h3>Guía de solicitudes, producción y despacho</h3>
            </div>
            <div class="operations-card__columns">
              <div>
                <h4>Producto fresco</h4>
                <ul class="operations-card__list">
                  <li>Se puede solicitar todos los días hasta las 3:00&nbsp;pm.</li>
                  <li>La producción y el despacho se realizan al día siguiente.</li>
                </ul>
              </div>
              <div>
                <h4>Empaquetado y congelado</h4>
                <ul class="operations-card__list">
                  <li>Solicitudes los lunes, miércoles y viernes (hasta las 3:00&nbsp;pm).</li>
                  <li>Producción programada los martes, jueves y sábado.</li>
                  <li>Despachos los miércoles, viernes y domingo.</li>
                </ul>
              </div>
            </div>
          </section>

          <div class="card-grid">
            <article class="action-card">
              <p class="eyebrow">Solicitudes de Sedes</p>
              <h3>Registrar nueva solicitud de sede</h3>
              <p>Captura fecha, hora, sede y los productos que requiere cada centro.</p>
              <button class="btn btn--ghost" data-view-target="solicitudes">Ir a Solicitudes de Sedes</button>
            </article>
            <article class="action-card">
              <p class="eyebrow">Entregado a Sedes</p>
              <h3>Confirmar entregas a sedes</h3>
              <p>Actualiza cantidades entregadas y responsables, incluso sin una solicitud previa.</p>
              <button class="btn btn--ghost" data-view-target="registros">Ir a Entregado a Sedes</button>
            </article>
            <article class="action-card">
              <p class="eyebrow">Producción</p>
              <h3>Merma de Producción</h3>
              <p>Registra la producción de cada sede para mantener el historial actualizado.</p>
              <button class="btn btn--ghost" data-view-target="mermas">Ir a Merma de Producción</button>
            </article>
          </div>
        </section>

        <section class="view" data-view="solicitudes">
          <header class="view__header">
            <div>
              <p class="eyebrow">Formularios</p>
              <h2>EL CENTRO · Solicitudes de Sedes</h2>
            </div>
            <button class="btn btn--ghost" data-view-target="catalogo">Ver catálogo</button>
          </header>

          <form id="solicitudes-form" class="card">
            <div class="form-grid">
              <label>
                <span>Fecha</span>
                <input type="date" name="fecha" required />
              </label>
              <label>
                <span>Hora</span>
                <input type="time" name="hora" required />
              </label>
              <label>
                <span>Sede</span>
                <select name="sede" data-role="sede-select" required></select>
              </label>
              <label>
                <span>Responsable de solicitud</span>
                <input type="text" name="responsable" placeholder="Nombre y apellido" required />
              </label>
            </div>

            <section class="products-box">
              <div class="products-box__header">
                <div>
                  <h3>Productos involucrados</h3>
                  <p>Selecciona productos del catálogo e indica la cantidad solicitada.</p>
                </div>
              </div>
              <div id="solicitud-product-rows" class="product-rows"></div>
              <div class="products-box__footer">
                <button type="button" class="btn btn--pill" id="add-product-row">Agregar producto</button>
              </div>
            </section>

            <div class="form-actions">
              <button type="submit" class="btn">Enviar solicitud</button>
            </div>
          </form>
        </section>

        <section class="view" data-view="registros">
          <header class="view__header">
            <div>
              <p class="eyebrow">Formularios</p>
              <h2>EL CENTRO · Entregado a Sedes</h2>
            </div>
            <button class="btn btn--ghost" data-view-target="solicitudes">Ver Solicitudes de Sedes</button>
          </header>

          <form id="registros-form" class="card">
            <div class="form-grid">
              <label>
                <span>Fecha</span>
                <input type="date" name="fecha" required />
              </label>
              <label>
                <span>Hora</span>
                <input type="time" name="hora" required />
              </label>
              <label>
                <span>Sede</span>
                <select name="sede" data-role="sede-select" required></select>
              </label>
              <label>
                <span>Responsable de entrega</span>
                <input type="text" name="responsableEntrega" placeholder="Nombre y apellido" required />
              </label>
            </div>

            <section class="products-box">
              <div class="products-box__header">
                <div>
                  <h3>Productos involucrados</h3>
                  <p>Selecciona cada producto entregado y registra la cantidad correspondiente.</p>
                </div>
              </div>
              <div id="registros-product-rows" class="product-rows"></div>

              <div class="toggle-field">
                <input type="checkbox" id="sin-solicitud" name="sinSolicitud" />
                <label for="sin-solicitud">
                  Registrar entrega sin solicitud previa (el sistema creará una fila con "SIN SOLICITUD").
                </label>
              </div>

              <div class="products-box__footer">
                <button type="button" class="btn btn--pill" id="add-registro-row">Agregar producto</button>
              </div>
            </section>

            <div class="form-actions">
              <button type="submit" class="btn">Actualizar Entregado a Sedes</button>
            </div>
          </form>
        </section>

        <section class="view" data-view="mermas">
          <header class="view__header">
            <div>
              <p class="eyebrow">Formularios</p>
              <h2>EL CENTRO · Merma de Producción</h2>
            </div>
            <button class="btn btn--ghost" data-view-target="catalogo">Ver catálogo</button>
          </header>

          <form id="merma-form" class="card">
            <div class="form-grid">
              <label>
                <span>Fecha</span>
                <input type="date" name="fecha" required />
              </label>
              <label>
                <span>Hora</span>
                <input type="time" name="hora" required />
              </label>
              <label>
                <span>Sede</span>
                <select name="sede" data-role="sede-select" required></select>
              </label>
              <label>
                <span>Responsable</span>
                <input type="text" name="responsable" placeholder="Nombre y apellido" required />
              </label>
            </div>

            <section class="products-box">
              <div class="products-box__header">
                <div>
                  <h3>Productos involucrados</h3>
                  <p>Selecciona los productos producidos en la sede seleccionada.</p>
                </div>
              </div>
              <div id="merma-product-rows" class="product-rows"></div>
              <div class="products-box__footer">
                <button type="button" class="btn btn--pill" id="add-merma-row">Agregar producto</button>
              </div>
            </section>

            <div class="form-actions">
              <button type="submit" class="btn">Registrar Producción</button>
            </div>
          </form>
        </section>

        <section class="view" data-view="catalogo">
          <header class="view__header">
            <div>
              <p class="eyebrow">Catálogo</p>
              <h2>Catálogo de productos sincronizado</h2>
              <p class="muted">Fuente: pestaña "PRODUCTOS" del Google Sheets proporcionado.</p>
            </div>
            <button class="btn btn--ghost" id="refresh-catalog">Actualizar lista</button>
          </header>

          <div class="card">
            <div class="catalog-toolbar">
              <input type="search" id="catalog-search" placeholder="Buscar por código o descripción" />
              <span id="catalog-status" class="status-badge">Sincronizando...</span>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Código</th>
                    <th>Descripción</th>
                    <th>Unidad primaria</th>
                  </tr>
                </thead>
                <tbody id="catalog-body">
                  <tr>
                    <td colspan="3" class="muted">Sin datos. Actualiza la lista.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="toast" class="toast" aria-live="polite"></div>
    <datalist id="product-options"></datalist>

    <script>
      window.APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyuog_HlM-BsnsS_xqk9rx8t4ysxtPyxJ1g_lkn_d5Swcq7zBHot9e5qU4t1AN-UM9sCA/exec';
    </script>
    <script src="script.js" defer></script>
  </body>
</html>
